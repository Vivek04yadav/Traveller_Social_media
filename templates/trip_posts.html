<!DOCTYPE html>
<html>
<head>
    <title>Trip Posts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .post-img { width: 100%; max-height: 350px; object-fit: cover; border-radius: 10px; }
        .post-card { margin-bottom: 2rem; }
    </style>
</head>
<body class="bg-dark" style="font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;">
    {% include 'navbar.html' %}
    <div class="container mt-4">
        <!-- Hero Section: Create Trip Post -->
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8">
                <div class="p-5 mb-4 rounded-4 shadow-lg text-center" style="background: linear-gradient(135deg, #232526 0%, #414345 100%);">
                    <h1 class="display-5 fw-bold mb-3" style="color:#3b82f6;">Create a Trip Post</h1>
                    <form method="POST" enctype="multipart/form-data" class="d-flex flex-column align-items-center gap-3">
                        <label for="imageUpload" class="form-label w-100 text-center mb-2" style="font-size:1.2rem; color:#fff;">Share your travel moment!</label>
                        <input type="file" name="image" id="imageUpload" class="form-control mb-2 w-100" required>
                        <input type="text" name="caption" class="form-control mb-2 w-100" placeholder="Write a caption...">
                        <button type="submit" class="btn btn-lg btn-primary d-flex align-items-center px-4 py-2" style="font-size:1.2rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-camera me-2" viewBox="0 0 16 16">
                                <path d="M9.5 2a.5.5 0 0 1 .5.5V3h1.5A1.5 1.5 0 0 1 13 4.5V5h1.5A1.5 1.5 0 0 1 16 6.5v6A1.5 1.5 0 0 1 14.5 14h-13A1.5 1.5 0 0 1 0 12.5v-6A1.5 1.5 0 0 1 1.5 5H3v-.5A1.5 1.5 0 0 1 4.5 3H6v-.5a.5.5 0 0 1 .5-.5h3ZM4.5 4A.5.5 0 0 0 4 4.5V5h8v-.5a.5.5 0 0 0-.5-.5h-7ZM1.5 6A.5.5 0 0 0 1 6.5v6a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-6a.5.5 0 0 0-.5-.5h-13ZM8 7a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z"/>
                            </svg>
                            Add Trip Post
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Section 2: View Trip Posts -->
        <h3 class="mb-4 text-center" style="color:#3b82f6;">Recent Trip Posts</h3>
        <div class="row g-4">
            {% for post in posts %}
            <div class="col-md-6 col-lg-4">
                <div class="card post-card shadow-lg border-0 h-100" style="background:#23272b; transition: transform 0.2s; border-radius: 18px;">
                    <img src="{{ url_for('static', filename='trip_posts/' ~ post.image) }}" class="post-img card-img-top" style="cursor:pointer; border-top-left-radius: 18px; border-top-right-radius: 18px;" onclick="window.location='{{ url_for('post_view', post_id=post.post_id) }}'">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center mb-2">
                            <img src="{{ get_avatar_url(post.username) }}" class="rounded-circle me-2" style="width:38px;height:38px;object-fit:cover;">
                            <div>
                                <span class="fw-semibold" style="color:#fff;">{{ post.username }}</span><br>
                                <span class="text-muted small">{{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
                            </div>
                        </div>
                        <p class="card-text mb-2" style="color:#e0e0e0;">{{ post.caption }}</p>
                        <div class="mt-auto d-flex align-items-center justify-content-between">
                            <form class="like-form d-flex align-items-center" action="{{ url_for('like_trip_post', post_id=post.post_id) }}" method="POST">
                                <button type="submit" class="btn btn-sm btn-outline-light like-btn" style="border-radius:50%; width:36px; height:36px; display:flex; align-items:center; justify-content:center;">
                                    <span class="like-icon">ü§ç</span>
                                </button>
                                <span class="like-count ms-2">{{ post.like_count if post.like_count is defined else 0 }}</span>
                            </form>
                            <a href="{{ url_for('post_view', post_id=post.post_id) }}#comments" class="btn btn-sm btn-outline-info d-flex align-items-center" style="border-radius:50%; width:36px; height:36px; display:flex; justify-content:center;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
                                    <path d="M2 2a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h10.586l2.707 2.707A1 1 0 0 0 16 13.586V4a2 2 0 0 0-2-2H2zm0 1h12a1 1 0 0 1 1 1v9.586l-2.293-2.293A1 1 0 0 0 12 11H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z"/>
                                </svg>
                                <span class="ms-1">{{ post.comment_count if post.comment_count is defined else 0 }}</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <script>
        document.querySelectorAll('.like-form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                fetch(this.action, {method: 'POST'})
                    .then(res => res.json())
                    .then(data => {
                        this.querySelector('.like-icon').textContent = data.liked ? '‚ù§Ô∏è' : 'ü§ç';
                        this.querySelector('.like-count').textContent = data.count;
                    });
            });
        });
        // Card hover effect
        document.querySelectorAll('.post-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-6px) scale(1.03)';
                this.style.boxShadow = '0 8px 32px rgba(0,0,0,0.25)';
            });
            card.addEventListener('mouseleave', function() {
                this.style.transform = '';
                this.style.boxShadow = '';
            });
        });
    </script>
</body>
</html>
